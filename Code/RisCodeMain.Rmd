---
title: "Laboratorio didattico"
subtitle: "The Psychological Burden of the COVID-19"
author: Corrado Caudek
date: "19-05-2022"
output:
  html_document:
    highlight: pygments
    fig_caption: yes
    toc: TRUE
    toc_depth: 2
    number_sections: TRUE
    toc_float:
      smooth_scroll: FALSE
---
<h1>Premesse generali</h1>
<p>1.Durante lo svolgimento dei vari report, per consentire una migliore comunicazione e fruibilita' del materiale da noi prodotto abbiamo usufruito dello strumento GitKraken, ovvero un software che ci consentiva di avere, ognuno sulla propria macchina, il progetto condiviso da tutti senza doverci incontrare fisicamente. <br>
2.Abbiamo suddiviso il lavoro fra noi tenendo di conto dei punti di forza di ciascuno, in modo da valorizzare più aspetti possibili del progetto</p>

<h1>In cosa consiste la ricerca </h1>
<p>I ricercatori si sono interessati alle possibili associazioni che possono intercorrere tra il carico psicologico dato dal COVID-19 e i seguenti fenomeni: gli atteggiamenti anti sistemici, quali l’insoddisfazione con l’ordine politico e la struttura sociale, l’attivismo politico pacifico e la violenza politica.<br>
I campioni sono adulti provenienti da USA, Italia, Danimarca e Ungheria.<br>
Infine, i dati sulle due ondate sono stati raccolti attraverso sondaggi somministrati online. </p>

<h1> perche’ e’ stata fatta la ricerca </h1>
<p>I ricercatori si sono posti l’obiettivo di trovare una correlazione tra manifestazioni violente, azioni sovversive e stress dovuti a restrizioni relative al COVID-19 contro enti governativi. Tutto ciò in riferimento a varie tipologie di governi nel mondo</p>


<h1>valorizzazione del risultato dell’articolo   </h1>
<p>I risultati riportano dati vari e differenti per ogni Nazione analizzata. Come inizialmente teorizzato dagli sperimentatori, i dati mettono in evidenza come le conseguenze della pandemia siano state alcune delle cause scatenanti delle manifestazioni e delle rivolte avvenute. Oltre a ciò i dati mostrano che, tra i 4 Paesi analizzati, in quelli con restrizioni più ingenti è stato rilevato un incremento del disordine politico. Questo invita a pensare che alcune delle manifestazioni avvenute nei precedenti anni sono state, con molta probabilità, scatenate da questi ultimi fattori di stress causati dalla pandemia.</p>

<h1>Cosa andremo a fare   </h1>
<p> Il nostro lavoro consiste in un'inferenza tra le medie, il cui fine è analizzare la differenza di effetto che è possibile riscontrare tra il campione americano e quello italiano. I dati che ci interessano, oltre al campione, si riferiscono alla scala Need of caos, la quale misura quanto concordano i cittadini con asserzioni che richiamano a comportamenti anti sistemici. <br>
Le risposte sono distribuite su una scala Likert che va da 0 a 6. Noi andremo a isolare quelle che comprendono entrambe le ondate.<br>
A seguire, andremo a isolare i dati dopo averli adattati opportunamente al range da 0 a 6 della scala Likert. 


<p>Carico i pacchetti necessari</p>
```{r}
suppressPackageStartupMessages({
  library("tidyverse")
  library("here")
  library("rio")
  library("brms")
  library("psych")
  library("cmdstanr")
  library("effectsize")
})
```

<p>Lettura dei dati</p>
```{r}
df <- rio::import(here::here("DatiR", "hope_violence_final.dta"))
```

<p>Per capire a cosa corrisponda la codifica di `country` conto il numero di casi in ciascun paese e in ciascuna wave. </p>
```{r}
table(df$wave, df$country)
```
<p>Confrontando le frequenze ottenute con i dati riportati dagi autori concludo che la codifica è la seguente:
<br>
- 1: USA; <br>
- 2: Denmark; <br>
- 3: Italy; <br>
- 4: Hungary.<br>
</p>

<h1> Need for Chaos Scale </h1>

<p>Gli autori riportano che gli item della scala Need for Chaos Scale (NFC) corrispondono alle colonne da Q27_1 a Q27_8. Seleziono dunque queste colonne dal dataframe:</p>
```{r}
nfc_items <- df %>%
   select(
     starts_with("Q27_")
    ) 
```

```{r}
nfc <- rowSums(nfc_items) 
hist(nfc)
```
<br><p>Questa codifica non ha senso, dato che ci aspettiamo che solo pochi partecipanti abbiano valori estremi e alti su questa scala. La media di NFC, infatti, non corrisponde a quello che riportano gli autori:</p>

```{r}
mean(nfc / 8)
```
<br><p>Quindi, la codifica deve essere invertita. Per fare questo uso la funzione `reverse.code()` del pacchetto `psych`:</p>

```{r}
keys <- rep(-1, 8)  #reverse all items
nfc_items_r <- reverse.code(keys, nfc_items, mini=rep(1, 8), maxi=rep(7, 8))
nfc_items[1:3, ]
nfc_items_r[1:3, ]
```

<br><p>Dato che gli autori usano la media, divido per 8</p>
```{r}
nfc <- rowSums(nfc_items_r) / 8
hist(nfc)
```

<br><p>Dato che gli autori usano la gamma 0-6<p>
```{r}
summary(nfc)
```

<br><p>sottraggo 1:</p>
```{r}
nfc <- (rowSums(nfc_items_r) / 8) - 1
hist(nfc)
```

```{r}
summary(nfc)
```

```{r}
df$nfc <- nfc
df %>% 
  group_by(wave) %>% 
  summarise(
    #aggiunta in df di media e deviazione di nfc
    avg_nfc = mean(nfc),
    sd_nfc = sd(nfc),
    #aggiunta numero di elementi delle ondate
    n = n()
  )
```
<br><p>Seleziono i dati di ciascuna wave:</p>
```{r}
wave_1 <- df %>% 
  dplyr::filter(wave == 1)

wave_2 <- df %>% 
  dplyr::filter(wave == 2)

nrow(wave_1)
nrow(wave_2)
```

<br><p>Estraggo solo le colonne di interesse:</p>
```{r}
w1 <- wave_1 %>% 
  dplyr::select(id, nfc, country)
w2 <- wave_2 %>% 
  dplyr::select(id, nfc, country)
```

<br><p>Estrapolo i dati dei paesi d'interesse (USA,ITA)</p>
```{r}
usa1 <- w1 %>% 
  dplyr::filter(country == 1)
usa2 <- w2 %>% 
  dplyr::filter(country == 1)

ita1 <- w1 %>% 
  dplyr::filter(country == 3)
ita2 <- w2 %>% 
  dplyr::filter(country == 3)
```
<br><p>Calcolo cohen_d<p>
```{r}
#Unione dei campioni
y_tot1<-c(usa1$nfc,ita1$nfc)
y_tot2<-c(usa2$nfc,ita2$nfc)
#Nella variabile dicotomica 0 corrisponde a gli USA ed 1 all' ITA
group_tot1 <- c(
  rep(0, length(usa1$nfc)), 
  rep(1, length(ita1$nfc))
  )
group_tot2 <- c(
  rep(0, length(usa2$nfc)), 
  rep(1, length(ita2$nfc))
  )

d1 <- tibble(y_tot1, group_tot1)
d2 <- tibble(y_tot2, group_tot2)
#ondata 1
data_list1 <- list( 
  N = length(y_tot1), 
  x = d1$group_tot1, 
  y = d1$y_tot1,
  #Prendo dei parametri poco informativi per le distribuzioni
  mu_alpha = 0,
  sigma_alpha = 2,
  mu_beta = 0,
  sigma_beta = 2,
  LOCATION = 0,
  SCALE = 2
  )
#ondata 2
data_list2 <- list( 
  N = length(y_tot2), 
  x = d2$group_tot2, 
  y = d2$y_tot2,
  #Prendo dei parametri poco informativi per le distribuzioni
  mu_alpha = 0,
  sigma_alpha = 2,
  mu_beta = 0,
  sigma_beta = 2,
  LOCATION = 0,
  SCALE = 2
  )

#ricerca e compilazione del modello stan
file <- file.path("modello_report.stan")
mod <- cmdstan_model(file)

#esecuzione di 4 catene con 10k iterazioni e 5k valori di burn-in

#ondata1
fit1 <- mod$sample( 
  data = data_list1, 
  iter_sampling = 10000L, 
  iter_warmup = 5000L, 
  chains = 4L, 
  refresh = 0
  )
#ondata2
fit2 <- mod$sample( 
  data = data_list2, 
  iter_sampling = 10000L, 
  iter_warmup = 5000L, 
  chains = 4L, 
  refresh = 0
  )

fit_stanfit1 <- rstan::read_stan_csv(fit1$output_files())
fit1$summary()

fit_stanfit2 <- rstan::read_stan_csv(fit2$output_files())
fit2$summary()
```

```{r}
posterior::summarise_draws(
  fit_stanfit1,
  ~ quantile(.x, probs = c(0.025, 0.5, 0.975))
)
(d1 <- cohens_d(y_tot1 ~ group_tot1, data = d1))

posterior::summarise_draws(
  fit_stanfit2,
  ~ quantile(.x, probs = c(0.025, 0.5, 0.975))
)
(d2 <- cohens_d(y_tot2 ~ group_tot2, data = d2))
```


<br>Il progetto e' stato svolto da:
<br>Virginia Simoncini
<br>William Tranchino
<br>Giulia Viliani
<br>Samanta Roncolino
<br>Regina Meister
<br>Lorenzo Zerauschek
<br>Alessia Nesti
<br>Martina Pierallini
<br>Greta Menichetti
<br>Elisa Pellegrini
<br>Chiara Manetti
<br>Elisa Placedi
<br>Flavia Natoli
<br>Costanza Lunari
<br>Marta Mariottini
<br>Gaia Lenzini
<br>Matteo Portici
<br>Camilla Pensalfini
<br>Leonardo Pecori
<br>Lorenza Paladini
<br>Eleonora Lunardi
<br>Serena Sooriya
<br>Isabella Scavone
<br>Alessia Massini
<br>Matilde Papini
<br>Martina Splendorini